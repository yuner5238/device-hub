<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8" />
  <title>设备详情</title>
  <script src="https://unpkg.com/vue@2"></script>
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <link
    rel="stylesheet"
    href="https://unpkg.com/element-ui/lib/theme-chalk/index.css"
  />
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      padding: 20px;
      background: #f5f5f7;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .title {
      font-weight: 700;
      font-size: 24px;
      color: #111;
    }

    .form-label {
      font-weight: 600;
      color: #444;
    }

    .el-card {
      border-radius: 14px;
      box-shadow: 0 4px 18px rgba(0, 0, 0, 0.12);
      background: white;
      padding: 24px 32px;
    }

    .el-button {
      border-radius: 8px;
    }

    @media (max-width: 600px) {
      body {
        padding: 14px;
      }

      .container {
        max-width: 100%;
      }

      .title {
        font-size: 20px;
      }
    }
  </style>
</head>

<body>
  <div id="app" class="container">
    <div class="header">
      <div class="title">设备详情</div>
      <el-button type="primary" @click="goHome">主页</el-button>
    </div>

    <el-card v-loading="loading">
      <div v-if="!device">
        <el-alert title="未找到设备" type="error"></el-alert>
      </div>

      <div v-else>
        <el-form
          :model="device"
          label-width="130px"
          label-position="left"
          v-if="!editMode"
        >
          <el-form-item label="设备名称">
            <span>{{ device.name || "N/A" }}</span>
          </el-form-item>
          <el-form-item label="位置">
            <span>{{ device.location || "N/A" }}</span>
          </el-form-item>
          <el-form-item label="购买日期">
            <span>{{ device.purchase_date || "N/A" }}</span>
          </el-form-item>
          <el-form-item label="安装日期">
            <span>{{ device.install_date || device.purchase_date || "N/A" }}</span>
          </el-form-item>
          <el-form-item label="备注">
            <span>{{ device.notes || "无" }}</span>
          </el-form-item>
        </el-form>

        <el-form
          :model="editForm"
          label-width="130px"
          label-position="left"
          v-else
        >
          <el-form-item label="位置">
            <el-input v-model="editForm.location"></el-input>
          </el-form-item>
          <el-form-item label="购买日期">
            <el-input v-model="editForm.purchase_date" placeholder="YYYY-MM-DD"></el-input>
          </el-form-item>
          <el-form-item label="安装日期">
            <el-input v-model="editForm.install_date" placeholder="YYYY-MM-DD"></el-input>
          </el-form-item>
          <el-form-item label="备注">
            <el-input
              type="textarea"
              v-model="editForm.notes"
              :rows="3"
            ></el-input>
          </el-form-item>
          <el-form-item label="编辑密码">
            <el-input
              type="password"
              v-model="editPassword"
              placeholder="请输入编辑密码"
            ></el-input>
          </el-form-item>
        </el-form>

        <div style="margin-top: 20px;">
          <el-button v-if="!editMode" type="primary" @click="startEdit">
            编辑
          </el-button>
          <el-button v-else type="success" @click="saveEdit">
            保存
          </el-button>
          <el-button v-if="editMode" @click="cancelEdit">取消</el-button>
        </div>
      </div>
    </el-card>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAiNEktrGgrjNfgpHVA6q1aBtDoZ6c5fMM",
      authDomain: "device-hub-5238.firebaseapp.com",
      databaseURL: "https://device-hub-5238-default-rtdb.firebaseio.com",
      projectId: "device-hub-5238",
      storageBucket: "device-hub-5238.appspot.com",
      messagingSenderId: "648686550801",
      appId: "1:648686550801:web:2f460487e32914042316b0",
      measurementId: "G-44L5PHN36Y",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    new Vue({
      el: "#app",
      data: {
        device: null,
        loading: true,
        editMode: false,
        editForm: {
          location: "",
          purchase_date: "",
          install_date: "",
          notes: "",
        },
        editPassword: "",
      },
      created() {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get("id
