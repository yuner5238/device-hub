<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <title>设备管理系统</title>
  <script src="https://unpkg.com/vue@2"></script>
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    .announcement {
      margin-bottom: 20px;
    }

    .device-card {
      margin-bottom: 10px;
    }
  </style>
</head>

<body>
  <div id="app" class="container">
    <el-card v-if="!authenticated" class="login-card">
      <h2>请输入密码以查看内容</h2>
      <el-input v-model="inputPassword" placeholder="请输入密码" show-password></el-input>
      <el-button type="primary" @click="checkPassword" style="margin-top: 10px">进入</el-button>
    </el-card>

    <div v-else>
      <el-card class="announcement">
        <h3>公告</h3>
        <el-timeline>
          <el-timeline-item v-for="(item, index) in announcements" :key="index" v-if="index < 3">
            {{ item }}
          </el-timeline-item>
        </el-timeline>
      </el-card>

      <el-card>
        <h3>设备列表</h3>
        <el-row :gutter="10">
          <el-col :span="24" v-for="device in devices" :key="device.id">
            <el-card class="device-card" shadow="hover" @click.native="goToDetail(device.id)">
              <div style="display: flex; justify-content: space-between">
                <div>
                  <div><strong>名称：</strong>{{ device.name || 'N/A' }}</div>
                  <div><strong>位置：</strong>{{ device.location || 'N/A' }}</div>
                </div>
                <div style="text-align: right">
                  <div><strong>上次维护：</strong>{{ device.last_maintenance || 'N/A' }}</div>
                </div>
              </div>
            </el-card>
          </el-col>
        </el-row>
        <div style="text-align: center; margin-top: 20px">
          <el-button v-if="hasMore" @click="loadMore">加载更多</el-button>
          <el-alert v-else title="没有更多了" type="info" show-icon></el-alert>
        </div>
      </el-card>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    new Vue({
      el: '#app',
      data: {
        authenticated: false,
        inputPassword: '',
        announcements: [
          '设备管理系统正式上线',
          '请定期检查设备状态',
          '如发现故障请及时上报'
        ],
        devices: [],
        allDevices: [],
        loadedCount: 0,
        loadSize: 5,
        hasMore: true
      },
      created() {
        this.fetchAllDevices();
      },
      methods: {
        checkPassword() {
          if (this.inputPassword === '123456') {
            this.authenticated = true;
            this.loadMore();
          } else {
            this.$message.error('密码错误');
          }
        },
        fetchAllDevices() {
          db.ref('devices').once('value').then(snapshot => {
            const val = snapshot.val();
            if (val) {
              this.allDevices = Object.keys(val).map(id => ({ id, ...val[id] }));
            }
          });
        },
        loadMore() {
          const nextBatch = this.allDevices.slice(this.loadedCount, this.loadedCount + this.loadSize);
          this.devices = this.devices.concat(nextBatch);
          this.loadedCount += nextBatch.length;
          if (this.loadedCount >= this.allDevices.length) {
            this.hasMore = false;
          }
        },
        goToDetail(id) {
          window.location.href = `device-detail.html?id=${id}`;
        }
      }
    });
  </script>
</body>

</html>
