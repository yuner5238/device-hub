<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8" />
  <title>设备管理主页</title>
  <script src="https://unpkg.com/vue@2"></script>
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css" />
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      padding: 20px;
      background: #f5f5f7;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    .device-card {
      margin-bottom: 15px;
      cursor: pointer;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      padding: 16px 20px;
      background: white;
      transition: box-shadow 0.3s ease;
    }

    .device-card:hover {
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .device-title {
      font-weight: 600;
      font-size: 18px;
      margin-bottom: 8px;
      color: #111;
    }

    .device-info {
      color: #555;
      font-size: 14px;
      line-height: 1.5;
    }

    .announcement {
      margin-bottom: 25px;
      background: #e5f0ff;
      border-left: 4px solid #007aff;
      padding: 12px 20px;
      border-radius: 10px;
      color: #004080;
      font-weight: 500;
      font-size: 15px;
    }

    @media (max-width: 600px) {
      body {
        padding: 12px;
      }

      .container {
        max-width: 100%;
      }

      .device-card {
        padding: 14px 16px;
      }

      .device-title {
        font-size: 16px;
      }

      .device-info {
        font-size: 13px;
      }
    }
  </style>
</head>

<body>
  <div id="app" class="container">
    <!-- 公告栏 -->
    <div v-for="(notice, idx) in announcements.slice(0,3)" :key="idx" class="announcement">
      {{ notice }}
    </div>

    <!-- 设备列表 -->
    <div v-for="device in devices" :key="device.id" class="device-card" @click="goToDevice(device.id)">
      <div class="device-title">{{ device.name || '未命名设备' }}</div>
      <div class="device-info">位置: {{ device.location || '未知' }}</div>
      <div class="device-info">购买日期: {{ device.purchase_date || '未知' }}</div>
      <div class="device-info">安装日期: {{ device.install_date || device.purchase_date || '未知' }}</div>
    </div>

    <div v-if="loading" style="text-align:center; color:#999; margin-top: 20px;">加载中...</div>
    <div v-if="error" style="color: red; text-align:center; margin-top: 20px;">{{ error }}</div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAiNEktrGgrjNfgpHVA6q1aBtDoZ6c5fMM",
      authDomain: "device-hub-5238.firebaseapp.com",
      databaseURL: "https://device-hub-5238-default-rtdb.firebaseio.com",
      projectId: "device-hub-5238",
      storageBucket: "device-hub-5238.appspot.com",
      messagingSenderId: "648686550801",
      appId: "1:648686550801:web:2f460487e32914042316b0",
      measurementId: "G-44L5PHN36Y",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    new Vue({
      el: "#app",
      data: {
        devices: [],
        announcements: [
          "设备维护请联系技术部",
          "周三将进行全网巡检",
          "请及时更新维护记录",
        ],
        loading: false,
        error: null,
      },
      created() {
        this.loadDevices();
      },
      methods: {
        async loadDevices() {
          this.loading = true;
          try {
            const snapshot = await db.ref("devices").once("value");
            const raw = snapshot.val() || {};
            this.devices = Object.entries(raw).map(([id, val]) => ({
              id,
              ...val,
            }));
          } catch (err) {
            this.error = "加载设备列表失败，请检查网络或配置";
            console.error(err);
          } finally {
            this.loading = false;
          }
        },
        goToDevice(id) {
          window.location.href = `device.html?id=${id}`;
        },
      },
    });
  </script>
</body>

</html>
