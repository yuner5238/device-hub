<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>设备详情</title>
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Segoe UI", sans-serif;
      background-color: #f5f5f7;
      margin: 0; padding: 0;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 32px 16px;
    }
    .top-bar {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 20px;
    }
    .device-card {
      background: #fff;
      border-radius: 18px;
      padding: 30px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.06);
    }
    h2 {
      font-size: 26px;
      margin-bottom: 16px;
      font-weight: 600;
    }
    .info-line {
      margin-bottom: 12px;
      font-size: 16px;
      color: #333;
    }
    .label {
      font-weight: 500;
      color: #666;
      margin-right: 6px;
    }
    .edit-btn {
      margin-top: 24px;
      float: right;
    }

    @media (max-width: 600px) {
      .device-card { padding: 20px; }
      h2 { font-size: 22px; }
      .info-line { font-size: 15px; }
    }
  </style>
</head>
<body>
  <div id="app" class="container">
    <div class="top-bar">
      <el-button type="text" icon="el-icon-s-home" @click="goHome">主页</el-button>
    </div>

    <div class="device-card" v-if="device">
      <h2>{{ device.name }}</h2>
      <div class="info-line"><span class="label">位置:</span>{{ device.location }}</div>
      <div class="info-line"><span class="label">采购日期:</span>{{ device.purchase_date }}</div>
      <div class="info-line"><span class="label">安装日期:</span>{{ device.install_date }}</div>
      <div class="info-line"><span class="label">备注:</span>{{ device.notes || '无' }}</div>
      <el-button type="primary" class="edit-btn" @click="promptEdit">编辑</el-button>
    </div>
    <div v-else>
      <el-empty description="未找到设备"></el-empty>
    </div>
  </div>

  <!-- 依赖 -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAiNEktrGgrjNfgpHVA6q1aBtDoZ6c5fMM",
      authDomain: "device-hub-5238.firebaseapp.com",
      databaseURL: "https://device-hub-5238-default-rtdb.firebaseio.com",
      projectId: "device-hub-5238",
      storageBucket: "device-hub-5238.firebasestorage.app",
      messagingSenderId: "648686550801",
      appId: "1:648686550801:web:2f460487e32914042316b0",
      measurementId: "G-44L5PHN36Y"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    new Vue({
      el: '#app',
      data: {
        deviceId: '',
        device: null,
        editPassword: '123456'
      },
      created() {
        const params = new URLSearchParams(location.search);
        this.deviceId = params.get('id');
        if (this.deviceId) this.fetchDevice();
      },
      methods: {
        fetchDevice() {
          db.ref(this.deviceId).once('value').then(snapshot => {
            this.device = snapshot.val();
          });
        },
        goHome() {
          window.location.href = 'index.html';
        },
        promptEdit() {
          this.$prompt('请输入编辑密码', '验证', {
            confirmButtonText: '确定',
            cancelButtonText: '取消',
            inputType: 'password'
          }).then(({ value }) => {
            if (value === this.editPassword) {
              this.editDevice();
            } else {
              this.$message.error('密码错误');
            }
          });
        },
        editDevice() {
          this.$prompt('修改位置', '编辑设备', {
            inputValue: this.device.location,
            confirmButtonText: '下一步',
            cancelButtonText: '取消'
          }).then(({ value: loc }) => {
            this.$prompt('修改备注', '编辑设备', {
              inputValue: this.device.notes || '',
              confirmButtonText: '保存',
              cancelButtonText: '取消'
            }).then(({ value: notes }) => {
              db.ref(this.deviceId).update({
                location: loc,
                notes: notes
              }).then(() => {
                this.$message.success('更新成功');
                this.device.location = loc;
                this.device.notes = notes;
              });
            });
          });
        }
      }
    });
  </script>
</body>
</html>
